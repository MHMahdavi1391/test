<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¨Ú©Ø§Ù¾ Ù…Ù¾â€ŒÙ‡Ø§ÛŒ Minecraft</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
    body {
        background-color: #000;
        color: #ffd700;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
    }
    h1 {
        margin-bottom: 20px;
    }
    button {
        background: linear-gradient(145deg, #ffd700, #b8860b);
        border: none;
        color: black;
        padding: 10px 20px;
        margin: 10px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(255,215,0,0.6);
        transition: transform 0.2s;
    }
    button:hover {
        transform: scale(1.05);
    }
    .world {
        background: #111;
        border: 1px solid #ffd700;
        border-radius: 16px;
        padding: 15px;
        margin: 15px auto;
        max-width: 400px;
        box-shadow: 0 0 15px rgba(255,215,0,0.4);
    }
    img {
        width: 100%;
        border-radius: 12px;
        margin-bottom: 10px;
    }
</style>
</head>
<body>
    <h1>ğŸ“‚ Ø¨Ú©Ø§Ù¾â€ŒÚ¯ÛŒØ± Ù…Ù¾â€ŒÙ‡Ø§ÛŒ Minecraft</h1>
    <button onclick="pickFolder()">Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ´Ù‡ MinecraftWorlds</button>
    <div id="worlds"></div>

<script>
let rootDir;

async function pickFolder() {
    try {
        rootDir = await window.showDirectoryPicker();
        document.getElementById("worlds").innerHTML = "";
        for await (const entry of rootDir.values()) {
            if (entry.kind === "directory") {
                loadWorld(entry);
            }
        }
    } catch (err) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ´Ù‡: " + err);
    }
}

async function loadWorld(folder) {
    try {
        let files = {};
        for await (const entry of folder.values()) {
            files[entry.name] = entry;
        }

        if (!files["level.dat"] && !files["level.dat_old"]) return;

        // Ø®ÙˆØ§Ù†Ø¯Ù† Ù†Ø§Ù… Ø¯Ù†ÛŒØ§
        let name = folder.name;
        if (files["levelname.txt"]) {
            const file = await files["levelname.txt"].getFile();
            name = await file.text();
        }

        // Ø¢ÛŒÚ©ÙˆÙ† Ø¯Ù†ÛŒØ§
        let imgURL = "";
        if (files["world_icon.jpeg"]) {
            const file = await files["world_icon.jpeg"].getFile();
            imgURL = URL.createObjectURL(file);
        }

        const container = document.getElementById("worlds");
        const div = document.createElement("div");
        div.className = "world";
        div.innerHTML = `
            ${imgURL ? `<img src="${imgURL}" alt="World Icon">` : ""}
            <h2>${name}</h2>
            <button onclick="backupWorld('${folder.name}')">ğŸ“¦ Ø¨Ú©Ø§Ù¾</button>
        `;
        container.appendChild(div);

    } catch (err) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ world:", err);
    }
}

async function backupWorld(worldName) {
    try {
        const folder = await rootDir.getDirectoryHandle(worldName);
        let zip = new JSZip();

        async function addToZip(path, dirHandle) {
            for await (const entry of dirHandle.values()) {
                if (entry.kind === "file") {
                    const file = await entry.getFile();
                    const content = await file.arrayBuffer();
                    zip.file(path + "/" + entry.name, content);
                } else if (entry.kind === "directory") {
                    await addToZip(path + "/" + entry.name, entry);
                }
            }
        }

        await addToZip("", folder);

        const blob = await zip.generateAsync({ type: "blob" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = worldName + ".mcworld";  // Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… mcworld
        a.click();
        URL.revokeObjectURL(a.href);

    } catch (err) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ú©Ø§Ù¾ Ú¯Ø±ÙØªÙ†: " + err);
    }
}
</script>
</body>
</html>
